generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model Order {
    id                    String        @id @default(cuid())
    userId                String
    status                OrderStatus   @default(PENDING)
    paymentStatus         PaymentStatus @default(PENDING)
    total                 Float
    address               String
    city                  String
    zipCode               String
    paymentMethod         String
    stripeSessionId       String?       @unique
    stripePaymentIntentId String?       @unique
    createdAt             DateTime      @default(now())
    updatedAt             DateTime      @updatedAt
    User                  User          @relation(fields: [userId], references: [id])
    OrderItem             OrderItem[]

    @@index([status])
    @@index([userId])
    @@index([stripeSessionId])
}

model OrderItem {
    id        String  @id @default(cuid())
    orderId   String
    productId String
    quantity  Int
    price     Float
    Order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    Product   Product @relation(fields: [productId], references: [id])

    @@index([orderId])
    @@index([productId])
}

model Product {
    id          String      @id @default(cuid())
    name        String
    description String
    price       Float
    image       String
    category    String
    stock       Int
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt
    OrderItem   OrderItem[]

    @@index([category])
}

model User {
    id        String   @id @default(cuid())
    email     String   @unique
    fullName  String
    password  String   @default("")
    role      UserRole @default(CUSTOMER)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    Order     Order[]
}

model AdminInvite {
    id        String    @id @default(cuid())
    email     String    @unique
    token     String    @unique
    role      UserRole  @default(ADMIN)
    invitedBy String
    expiresAt DateTime
    usedAt    DateTime?
    createdAt DateTime  @default(now())
}

enum UserRole {
    CUSTOMER
    ADMIN
    SUPER_ADMIN
}

enum OrderStatus {
    PENDING
    PROCESSING
    SHIPPED
    DELIVERED
    CANCELLED
}

enum PaymentStatus {
    PENDING
    PROCESSING
    PAID
    FAILED
    REFUNDED
}
